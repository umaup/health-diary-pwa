<!DOCTYPE html>

<html lang="zh-Hant">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>

  <title>Uma健康日誌</title>

  <meta name="theme-color" content="#f8fafc"/>

  <script src="https://cdn.tailwindcss.com"></script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/dayjs"></script>

  <script src="https://cdn.jsdelivr.net/npm/dayjs/plugin/relativeTime.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/dayjs/plugin/customParseFormat.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/dayjs/locale/zh-tw.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>

    tailwind.config = { darkMode: 'class' };

  </script>

  <style>

    body { font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif; -webkit-tap-highlight-color: transparent; }

    .page { display: none; animation: fadeIn 0.3s ease-in-out; }

    .page.active { display: block; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px);} to { opacity: 1; transform: translateY(0);} }

    .nav-item { border-bottom: 3px solid transparent; transition: all 0.2s ease-in-out; }

    .nav-item.active { border-bottom-color: #3B82F6; }

    .nav-item.active svg, .nav-item.active .nav-text { color: #3B82F6; }

    .nav-item.active .nav-text { font-weight: 600; }

    #toast-notification { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); transition: top 0.4s, opacity 0.4s; opacity: 0; z-index: 9999; }

    #toast-notification.show { top: 20px; opacity: 1; }

    .bristol-item, .color-item { transition: all 0.2s; }

    .bristol-item.bristol-selected, .color-item.bristol-selected { border-color: #3B82F6; background-color: #EFF6FF; }

    html.dark .bristol-item.bristol-selected, html.dark .color-item.bristol-selected { background-color: #0b3a75; border-color: #60a5fa; }

    .star-rating .star { color: #d1d5db; cursor: pointer; transition: color 0.2s; }

    .star-rating .star:hover, .star-rating .star.selected { color: #f59e0b; }

    .custom-checkbox:checked { background-color: #3B82F6; border-color: #3B82F6; }

    .option-button-group .option-button.selected { background-color: #3B82F6; color: white; border-color: #3B82F6; }

    .bowel-record-disabled { opacity: 0.5; pointer-events: none; }

    #confirmation-modal.hidden { display: none; }

    .form-section { border-top-width: 1px; padding-top: 10px; margin-top: 10px; }

    .form-section-label { display: inline-flex; align-items: center; gap: 6px; font-weight: 600; font-size: 0.9rem; }

    .form-section-label svg { width: 16px; height: 16px; }

    button:focus-visible, .option-button:focus-visible, .bristol-item:focus-visible, .color-item:focus-visible { outline: 2px solid #3B82F6; outline-offset: 2px; }

    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    .spinner { animation: spin 1s linear infinite; }

    #app-header-top { transition: max-height 0.3s, padding 0.3s, border 0.3s; max-height: 100px; overflow: hidden; }

    .fullscreen-mode #app-header-top { max-height: 0; padding-top: 0; padding-bottom: 0; border-bottom-width: 0; }

  </style>

</head>

<body class="bg-slate-100 dark:bg-slate-950 transition-colors duration-300">

<div id="app" class="max-w-lg mx-auto bg-slate-50 dark:bg-slate-900 min-h-screen shadow-lg relative transition-colors duration-300 overflow-x-hidden">

  <header id="app-header" class="bg-white/80 dark:bg-slate-800/80 sticky top-0 z-10 shadow-sm transition-colors">

    <div id="app-header-top" class="text-slate-800 dark:text-slate-200 p-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center">

      <button id="fullscreen-toggle" class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors" aria-label="切換全螢幕">

        <svg id="icon-maximize" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>

        <svg id="icon-minimize" xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="hidden"><path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"/></svg>

      </button>

      <h1 id="header-title" class="text-xl font-bold tracking-wide text-center">Uma健康日誌</h1>

      <button id="theme-toggle" class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors" aria-label="切換主題">

        <svg id="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="hidden"><circle cx="12" cy="12" r="5"></circle></svg>

        <svg id="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="hidden"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>

      </button>

    </div>

    <nav id="app-nav" class="border-b border-slate-200 dark:border-slate-700 flex justify-around">

      <button class="nav-item flex flex-col items-center justify-center w-full text-slate-500 dark:text-slate-400 py-2" data-page="log-page"><span class="nav-text text-xs mt-1">日誌</span></button>

      <button class="nav-item flex flex-col items-center justify-center w-full text-slate-500 dark:text-slate-400 py-2" data-page="stats-page"><span class="nav-text text-xs mt-1">統計</span></button>

      <button class="nav-item flex flex-col items-center justify-center w-full text-slate-500 dark:text-slate-400 py-2" data-page="history-page"><span class="nav-text text-xs mt-1">歷史</span></button>

    </nav>

  </header>

  <div id="toast-notification" class="px-6 py-3 rounded-full font-semibold text-white shadow-lg"></div>

  <main class="p-4">

    <!-- 日誌頁 -->

    <div id="log-page" class="page active">

      <div class="space-y-6">

        <section class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm">

          <label for="log-date" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">紀錄日期</label>

          <input type="date" id="log-date" class="w-full p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 rounded-md"/>

        </section>

        <section class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm space-y-4">

          <h2 class="text-lg font-semibold">排便紀錄</h2>

          <label class="flex items-center select-none">

            <input type="checkbox" id="no-bowel-today" class="h-4 w-4 rounded border-gray-300 text-blue-600 custom-checkbox mr-2"/>

            今天無排便

          </label>

          <div id="bowel-records-container" class="space-y-5"></div>

          <button id="add-bowel-record-btn" class="w-full mt-2 text-blue-600 font-semibold py-2 px-4 rounded-lg border-2 border-dashed border-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/50 transition flex items-center justify-center">新增一筆排便紀錄</button>

        </section>

        <section class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm">

          <h3 class="text-base font-semibold mb-2">昨晚睡眠品質</h3>

          <div id="sleep-quality-rating" class="star-rating flex items-center justify-center space-x-2 text-4xl"></div>

        </section>

        <section class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm">

          <h3 class="text-base font-semibold mb-2">RBD 症狀 (昨晚)</h3>

          <div id="rbd-symptoms" class="space-y-2"></div>

          <textarea id="rbd-other-notes" rows="2" class="w-full mt-2 p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 rounded-md hidden" placeholder="請描述其他症狀"></textarea>

        </section>

        <section class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm">

          <h3 class="text-base font-semibold mb-2">用藥紀錄</h3>

          <textarea id="medication-log" rows="3" class="w-full p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 rounded-md" placeholder="請記錄您今天服用的藥物、時間和劑量。"></textarea>

        </section>

        <section class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm">

          <h3 class="text-base font-semibold mb-2">每日備註</h3>

          <textarea id="daily-notes" rows="3" class="w-full p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 rounded-md" placeholder="記錄任何其他想記下的事情..."></textarea>

        </section>

        <button id="save-log-button" class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center text-lg">

          <span id="save-log-button-content">儲存本日完整日誌</span>

        </button>

      </div>

    </div>

    <!-- 統計頁 -->

    <div id="stats-page" class="page space-y-6">

      <div class="flex justify-between items-center bg-white dark:bg-slate-800 p-3 rounded-xl shadow-sm">

        <button id="prev-week-btn" class="px-3 py-2 rounded-md bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-slate-200">&lt; 上一週</button>

        <h2 id="stats-week-title" class="text-lg font-semibold text-slate-800 dark:text-slate-200">本週統計</h2>

        <button id="next-week-btn" class="px-3 py-2 rounded-md bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-slate-200" disabled>下一週 &gt;</button>

      </div>

      <section id="ai-insight-section" class="bg-blue-50 dark:bg-blue-900/50 border-l-4 border-blue-500 p-4 rounded-r-lg shadow-sm space-y-2 text-blue-800 dark:text-blue-200">

        <h3 class="text-lg font-semibold">本週洞察</h3>

        <p id="ai-insight-text" class="text-sm"></p>

      </section>

      <section id="bowel-analysis-section" class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm space-y-4"></section>

      <section class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm space-y-4">

        <h3 class="text-lg font-semibold">昨晚睡眠品質趨勢</h3>

        <div class="relative h-64 md:h-80"><canvas id="sleep-chart"></canvas></div>

        <div id="stats-summary-sleep" class="text-sm text-center text-slate-500 dark:text-slate-400 pt-2"></div>

      </section>

      <section class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm space-y-4">

        <h3 class="text-lg font-semibold">排便時間點分佈</h3>

        <div class="relative h-64 md:h-80"><canvas id="bowel-time-chart"></canvas></div>

      </section>

      <section class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm space-y-4">

        <h3 class="text-lg font-semibold">排便類型趨勢</h3>

        <div class="relative h-64 md:h-80"><canvas id="bowel-chart"></canvas></div>

        <div id="stats-summary-bowel" class="text-sm text-center text-slate-500 dark:text-slate-400 pt-2"></div>

      </section>

      <section class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm space-y-4">

        <h3 class="text-lg font-semibold">RBD 症狀統計</h3>

        <div class="relative h-64 md:h-80"><canvas id="rbd-chart"></canvas></div>

        <div id="stats-summary-rbd" class="text-sm text-center text-slate-500 dark:text-slate-400 pt-2"></div>

      </section>

      <section id="health-tips-section" class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm space-y-3"></section>

      <div class="flex gap-3 justify-end mt-6">

        <button id="export-week-pdf-btn" class="bg-blue-600 text-white px-4 py-2 rounded">匯出本週PDF</button>

        <button id="export-month-pdf-btn" class="bg-green-600 text-white px-4 py-2 rounded">匯出本月PDF</button>

      </div>

    </div>

    <!-- 歷史頁 -->

    <div id="history-page" class="page">

      <section class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm">

        <h2 class="text-lg font-semibold mb-4">資料管理</h2>

        <div class="grid grid-cols-2 gap-2 mb-4">

          <button id="export-csv-btn" class="w-full bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg">匯出CSV</button>

          <button id="import-csv-btn" class="w-full bg-sky-500 text-white font-semibold py-2 px-4 rounded-lg">匯入CSV</button>

        </div>

        <input type="file" id="import-file-input" class="hidden" accept=".csv, text/csv"/>

        <h2 class="text-lg font-semibold mb-4 mt-6">所有日誌紀錄</h2>

        <div id="history-list" class="space-y-3"></div>

      </section>

    </div>

  </main>

  <div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">

    <div class="bg-white dark:bg-slate-800 rounded-lg shadow-xl p-6 max-w-sm w-full">

      <h3 id="modal-title" class="text-lg font-bold text-slate-800 dark:text-slate-200 mb-2">確認操作</h3>

      <p id="modal-message" class="text-sm text-slate-600 dark:text-slate-400 mb-6">您確定要執行此操作嗎？</p>

      <div class="flex justify-end space-x-3">

        <button id="modal-cancel-btn" class="px-4 py-2 bg-slate-200 dark:bg-slate-600 text-slate-800 dark:text-slate-200 rounded-md">取消</button>

        <button id="modal-confirm-btn" class="px-4 py-2 bg-red-500 text-white rounded-md">確定</button>

      </div>

    </div>

  </div>

</div>

<script>

/* --- dayjs初始化 --- */

dayjs.extend(dayjs_plugin_relativeTime);

dayjs.extend(dayjs_plugin_customParseFormat);

dayjs.locale('zh-tw');



/* --- 資料結構與初始狀態 --- */

let appState = {

  dailyLogs: {},

  currentDate: dayjs().format('YYYY-MM-DD'),

  currentPage: 'log-page',

  charts: { bowel: null, rbd: null, bowelTime: null, sleep: null },

  statsWeekOffset: 0,

  isFullscreen: false,

};



/* --- DOM物件 --- */

const DOM = {

  app: document.getElementById('app'),

  appHeaderTop: document.getElementById('app-header-top'),

  appNav: document.getElementById('app-nav'),

  html: document.documentElement,

  headerTitle: document.getElementById('header-title'),

  pages: document.querySelectorAll('.page'),

  navItems: document.querySelectorAll('.nav-item'),

  toast: document.getElementById('toast-notification'),

  logDate: document.getElementById('log-date'),

  noBowelToday: document.getElementById('no-bowel-today'),

  bowelRecordsContainer: document.getElementById('bowel-records-container'),

  addBowelRecordBtn: document.getElementById('add-bowel-record-btn'),

  sleepQualityRating: document.getElementById('sleep-quality-rating'),

  rbdSymptoms: document.getElementById('rbd-symptoms'),

  rbdOtherNotes: document.getElementById('rbd-other-notes'),

  medicationLog: document.getElementById('medication-log'),

  dailyNotes: document.getElementById('daily-notes'),

  saveLogButton: document.getElementById('save-log-button'),

  saveLogButtonContent: document.getElementById('save-log-button-content'),

  statsPage: document.getElementById('stats-page'),

  aiInsightText: document.getElementById('ai-insight-text'),

  historyList: document.getElementById('history-list'),

  statsWeekTitle: document.getElementById('stats-week-title'),

  prevWeekBtn: document.getElementById('prev-week-btn'),

  nextWeekBtn: document.getElementById('next-week-btn'),

  bowelAnalysisSection: document.getElementById('bowel-analysis-section'),

  sleepChartCanvas: document.getElementById('sleep-chart'),

  bowelTimeChartCanvas: document.getElementById('bowel-time-chart'),

  bowelChartCanvas: document.getElementById('bowel-chart'),

  rbdChartCanvas: document.getElementById('rbd-chart'),

  statsSummarySleep: document.getElementById('stats-summary-sleep'),

  statsSummaryBowel: document.getElementById('stats-summary-bowel'),

  statsSummaryRbd: document.getElementById('stats-summary-rbd'),

  healthTipsSection: document.getElementById('health-tips-section'),

  exportCsvBtn: document.getElementById('export-csv-btn'),

  importCsvBtn: document.getElementById('import-csv-btn'),

  importFileInput: document.getElementById('import-file-input'),

  confirmationModal: document.getElementById('confirmation-modal'),

  modalTitle: document.getElementById('modal-title'),

  modalMessage: document.getElementById('modal-message'),

  modalCancelBtn: document.getElementById('modal-cancel-btn'),

  modalConfirmBtn: document.getElementById('modal-confirm-btn'),

  themeToggle: document.getElementById('theme-toggle'),

  themeIconSun: document.getElementById('theme-icon-sun'),

  themeIconMoon: document.getElementById('theme-icon-moon'),

  fullscreenToggle: document.getElementById('fullscreen-toggle'),

  iconMaximize: document.getElementById('icon-maximize'),

  iconMinimize: document.getElementById('icon-minimize'),

  exportWeekPdfBtn: document.getElementById('export-week-pdf-btn'),

  exportMonthPdfBtn: document.getElementById('export-month-pdf-btn'),

};



/* --- 其他常數資料（略） --- */

// Bristol、顏色、症狀等資料，請依你的原始程式碼填入



/* --- 初始化 --- */

function init() {

  setupPWA();

  setupTheme();

  loadData();

  renderStaticComponents();

  setupEventListeners();

  setupGestureListeners();

  DOM.logDate.value = appState.currentDate;

  loadLogForDate(appState.currentDate);

  navigateTo('log-page');

}



/* --- PDF匯出 --- */

function getWeekData(weekStart) {

  const data = { dates: [], logs: [], sleep: [], bowelCount: [], rbdCount: [], bowelTypes: [] };

  for (let i = 0; i < 7; i++) {

    const date = weekStart.add(i, 'day');

    const dateStr = date.format('YYYY-MM-DD');

    const log = appState.dailyLogs[dateStr];

    data.dates.push(dateStr);

    if (log) {

      data.logs.push(log);

      data.sleep.push(log.sleep || 0);

      data.bowelCount.push(log.bowel ? log.bowel.length : 0);

      data.bowelTypes.push(log.bowel ? log.bowel.flatMap(b => b.types) : []);

      data.rbdCount.push(log.rbd && log.rbd.symptoms && !log.rbd.symptoms.includes('none') ? log.rbd.symptoms.length : 0);

    } else {

      data.logs.push(null);

      data.sleep.push(0);

      data.bowelCount.push(0);

      data.bowelTypes.push([]);

      data.rbdCount.push(0);

    }

  }

  // 統計

  const validSleep = data.sleep.filter(s => s > 0);

  data.avgSleep = validSleep.length ? (validSleep.reduce((a,b)=>a+b,0)/validSleep.length).toFixed(1) : 0;

  data.totalBowel = data.bowelCount.reduce((a,b)=>a+b,0);

  data.avgBMs = (data.totalBowel/7).toFixed(1);

  data.allTypes = data.bowelTypes.flat().filter(b=>!!b);

  data.avgType = data.allTypes.length ? (data.allTypes.reduce((a,b)=>a+b,0)/data.allTypes.length).toFixed(1) : 0;

  data.totalRbd = data.rbdCount.reduce((a,b)=>a+b,0);

  return data;

}

function getMonthData(monthStart) {

  const data = { dates: [], logs: [], sleep: [], bowelCount: [], rbdCount: [], bowelTypes: [] };

  const days = monthStart.daysInMonth();

  for (let i = 0; i < days; i++) {

    const date = monthStart.add(i, 'day');

    const dateStr = date.format('YYYY-MM-DD');

    const log = appState.dailyLogs[dateStr];

    data.dates.push(dateStr);

    if (log) {

      data.logs.push(log);

      data.sleep.push(log.sleep || 0);

      data.bowelCount.push(log.bowel ? log.bowel.length : 0);

      data.bowelTypes.push(log.bowel ? log.bowel.flatMap(b => b.types) : []);

      data.rbdCount.push(log.rbd && log.rbd.symptoms && !log.rbd.symptoms.includes('none') ? log.rbd.symptoms.length : 0);

    } else {

      data.logs.push(null);

      data.sleep.push(0);

      data.bowelCount.push(0);

      data.bowelTypes.push([]);

      data.rbdCount.push(0);

    }

  }

  const validSleep = data.sleep.filter(s => s > 0);

  data.avgSleep = validSleep.length ? (validSleep.reduce((a,b)=>a+b,0)/validSleep.length).toFixed(1) : 0;

  data.totalBowel = data.bowelCount.reduce((a,b)=>a+b,0);

  data.avgBMs = (data.totalBowel/days).toFixed(1);

  data.allTypes = data.bowelTypes.flat().filter(b=>!!b);

  data.avgType = data.allTypes.length ? (data.allTypes.reduce((a,b)=>a+b,0)/data.allTypes.length).toFixed(1) : 0;

  data.totalRbd = data.rbdCount.reduce((a,b)=>a+b,0);

  return data;

}

function exportPDF(type = "week") {

  const { jsPDF } = window.jspdf;

  const doc = new jsPDF({ format: "a4" }); // A4尺寸



  let y = 15;

  doc.setFont("helvetica", "bold");

  doc.setFontSize(18);



  let title, data, dateRange;

  if (type === "week") {

    const weekStart = dayjs().subtract(appState.statsWeekOffset, 'week').startOf('week');

    const weekEnd = dayjs().subtract(appState.statsWeekOffset, 'week').endOf('week');

    title = `健康日誌週報表`;

    dateRange = `${weekStart.format('YYYY/MM/DD')} - ${weekEnd.format('YYYY/MM/DD')}`;

    data = getWeekData(weekStart);

  } else {

    const monthStart = dayjs().startOf('month');

    const monthEnd = dayjs().endOf('month');

    title = `健康日誌月報表`;

    dateRange = `${monthStart.format('YYYY/MM/DD')} - ${monthEnd.format('YYYY/MM/DD')}`;

    data = getMonthData(monthStart);

  }

  doc.text(title, 15, y); y += 10;

  doc.setFontSize(13);

  doc.setFont("helvetica", "normal");

  doc.text(`統計區間：${dateRange}`, 15, y); y += 10;

  doc.setLineWidth(0.5);

  doc.line(15, y, 195, y); y += 5;



  doc.setFontSize(12);

  doc.text(`平均睡眠品質：${data.avgSleep} 顆星`, 15, y); y += 8;

  doc.text(`平均排便次數：${data.avgBMs} 次/天`, 15, y); y += 8;

  doc.text(`平均排便類型：${data.avgType} 型`, 15, y); y += 8;

  doc.text(`RBD症狀出現次數：${data.totalRbd} 次`, 15, y); y += 10;

  doc.setLineWidth(0.3);

  doc.line(15, y, 195, y); y += 8;



  doc.setFontSize(12);

  data.dates.forEach((dateStr, idx) => {

    const log = data.logs[idx];

    if (!log) return;

    if (y > 270) { doc.addPage(); y = 15; }

    doc.setFont("helvetica", "bold");

    doc.text(`${dayjs(dateStr).format("YYYY/MM/DD")}`, 15, y); y += 7;

    doc.setFont("helvetica", "normal");

    doc.text(`睡眠品質: ${log.sleep || '未記錄'} 顆星`, 20, y); y += 7;

    if (log.noBowel) {

      doc.text(`排便: 無`, 20, y); y += 7;

    } else if (log.bowel && log.bowel.length > 0) {

      log.bowel.forEach((b, bIdx) => {

        doc.text(`排便${bIdx+1}: 時間${b.bowelTimeOfDay || '未記錄'}, 類型${b.types.join('/') || '-'}, 顏色${b.color || '-'}`, 23, y); y += 7;

        doc.text(`症狀: ${b.symptoms.join('/') || '-'}, 附加狀態: ${b.additionalStatus.join('/') || '-'}`, 23, y); y += 7;

        if (b.notes) { doc.text(`備註: ${b.notes}`, 23, y); y += 7; }

      });

    }

    let rbd = log.rbd && log.rbd.symptoms ? log.rbd.symptoms.join('/') : '';

    doc.text(`RBD症狀: ${rbd || '無'}${log.rbd && log.rbd.other ? '，其他：'+log.rbd.other : ''}`, 20, y); y += 7;

    doc.text(`用藥紀錄: ${log.meds || '無'}`, 20, y); y += 7;

    doc.text(`每日備註: ${log.dailyNotes || '無'}`, 20, y); y += 9;

    doc.setLineWidth(0.1);

    doc.line(15, y, 195, y); y += 6;

  });



  doc.save(`${title}_${dayjs().format('YYYYMMDD')}.pdf`);

}



/* --- 匯出PDF按鈕綁定 --- */

DOM.exportWeekPdfBtn.onclick = () => exportPDF("week");

DOM.exportMonthPdfBtn.onclick = () => exportPDF("month");



/* --- 其他功能請補充你的原程式碼 --- */

init();

</script>

</body>

</html>
